

import v.builtins.opt.*;
import v.builtins.drop.*;
import printutils.*;

struct MyList<T Ref> where func drop(T)void {
  value T;
  next ^Opt<^MyList<T>>;
}

abstract func forEach<F, T>(virtual opt &Opt<MyList<T>>, func F) int
where func drop(T)void, func(&F, &T)void, func drop(F)void;

func forEach<F, T>(opt &None<MyList<T>>, func F) int
where func drop(T)void, func(&F, &T)void, func drop(F)void
{ return 0; }
func forEach<F, T>(opt &Some<MyList<T>>, func F) int
where func drop(T)void, func(&F, &T)void, func drop(F)void
{
   forEach<F, T>(opt.value, func);
   return 0;
}
func forEach<F, T>(list &MyList<T>, func F) int
where func drop(T)void, func(&F, &T)void, func drop(F)void
{
  func(list.value);
  forEach<F, T>(list.next, func);
  return 0;
}

exported func main() int {
  list = MyList<int>(10, Some<^MyList<int>>(MyList<int>(20, Some<^MyList<int>>(MyList<int>(30, None<^MyList<int>>())))));
  forEach(&list, { print(_); });
  return 0;
}
